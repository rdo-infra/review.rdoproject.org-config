diskimages:
  - name: rdo-centos-7
    elements:
      - centos-minimal
      - nodepool-minimal
      - simple-init
      - sf-zuul-worker
      - jenkins-worker
      - rdo-base
    env-vars:
      QEMU_IMG_OPTIONS: compat=0.10
      DIB_GRUB_TIMEOUT: '0'
      DIB_YUM_MINIMAL_CREATE_INTERFACES: '1'
  - name: upstream-centos-7
    elements:
      - centos-minimal
      - vm
      - simple-init
      - openstack-repos
      - nodepool-base
      - cache-devstack
      - growroot
      - infra-package-needs
      - epel
      - upstream-image-tweaks
    env-vars:
      QEMU_IMG_OPTIONS: compat=0.10
      DIB_GRUB_TIMEOUT: '0'
      DIB_EPEL_DISABLED: '1'
      NODEPOOL_SSH_KEY: >-
        AAAAB3NzaC1yc2EAAAADAQABAAABAQC/9gkwPtX4SRAeK6XUE4JaegB6s7E0jI3O4+REZVp+r8OVL6bvz17bYIxAhDHWuV0NlOdc5CzN8y9ubBiIrYwNlhMLF02rZ6YfrKGjzXDeN8oA28H11Wqhkl53VMwFIYuIwt6XcYUWoesfNaSNRasN+aGQZ7E9vzQeCFjC8gUlH1xFJYu1gUQ9xUbK88RKlB0FJmIxm9PX5lr8GsjekqKJ3h+6jlG/XqvvE/EZ9Ho75bDDw9nZ9xJHIXYVzp57Z3rTS8HUO8Rnhlvl7QpzH/c8LKKrjkGiLQH+KSoXqA/4A46dqI6RF4xehyZ1sgRBl6YTfMV/sklkZPix8qLf5p+j
      ELEMENTS_PATH: /opt/git/openstack-infra/project-config/nodepool/elements:/etc/nodepool/elements
      NODEPOOL_SCRIPTDIR: /opt/git/openstack-infra/project-config/nodepool/scripts
      # bluebox-sjc2 is closer than rax-dfw from Phoenix
      # (where rdo-cloud is located) but rax-dfw is tuned for higher capacity
      NODEPOOL_MIRROR_HOST: mirror.dfw.rax.openstack.org
      # Note (dmsimard)
      # We have stopped synchronizing project-config over concerns of divergence
      # with the zuul v3 migration as well as the gerrit upgrade upstream
      # We need to also pin the location where the project-config/nodepool/elements/openstack-repos
      # element retrieves it's project list to match our pin
      DIB_CUSTOM_PROJECTS_LIST_URL: https://git.openstack.org/cgit/openstack-infra/project-config/plain/gerrit/projects.yaml?id=d2efe2e71ed07e17b8f0922934665dfb3a6fdbd0
  # NOTE(jpena): We had to manually cherry-pick https://github.com/openstack/diskimage-builder/commit/6ffde2e5964acb9183616a7c2ab67a10d4712c3e
  # to the review.rdoproject.org and nb01.rdoproject.org machines to avoid the coreutils issue when creating the image
  - name: rdo-fedora-26
    elements:
      - fedora-minimal
      - nodepool-minimal
      - simple-init
      - zuul-cloner-pip
      - jenkins-worker
      - rdo-base
    env-vars:
      DIB_RELEASE: '26'
      QEMU_IMG_OPTIONS: compat=0.10
      DIB_GRUB_TIMEOUT: '0'

labels:
  - name: rdo-centos-7
    min-ready: 7
    image: rdo-centos-7
    providers:
      - name: rdo-cloud
  - name: rdo-centos-7-ssd
    min-ready: 6
    image: rdo-centos-7
    providers:
      - name: rdo-cloud-ssd
  - name: rdo-fedora-26
    min-ready: 2
    image: rdo-fedora-26
    providers:
      - name: rdo-cloud
  - name: upstream-centos-7
    min-ready: 5
    image: upstream-centos-7
    ready-script: configure_mirror_host.sh
    providers:
      - name: rdo-cloud-tripleo
  - name: upstream-centos-7-2-node
    min-ready: 5
    image: upstream-centos-7
    providers:
      - name: rdo-cloud-tripleo
    ready-script: multinode_setup_host.sh
    subnodes: 1

providers:
  - name: rdo-cloud
    boot-timeout: 120
    clean-floating-ips: true
    cloud: rdo-cloud
    max-servers: 15
    pool: public
    rate: 0.25
    networks:
      - name: private
    images:
      - name: rdo-centos-7
        diskimage: rdo-centos-7
        name-filter: rdo.m1.nodepool
        username: jenkins
        min-ram: 8192
        config-drive: true
        boot-from-volume: true
      - name: rdo-fedora-26
        diskimage: rdo-fedora-26
        name-filter: rdo.m1.nodepool
        username: jenkins
        min-ram: 8192
        config-drive: true
        boot-from-volume: true
  - name: rdo-cloud-ssd
    boot-timeout: 120
    clean-floating-ips: true
    cloud: rdo-cloud-ssd
    max-servers: 15
    pool: public
    rate: 0.25
    networks:
      - name: private
    images:
      - name: rdo-centos-7
        diskimage: rdo-centos-7
        name-filter: ci.m1.nodepool
        username: jenkins
        min-ram: 8192
        config-drive: true
  - name: rdo-cloud-tripleo
    boot-timeout: 120
    clean-floating-ips: true
    cloud: rdo-cloud-tripleo
    max-servers: 75
    pool: public
    rate: 0.1
    networks:
      - name: private
    images:
      - name: upstream-centos-7
        diskimage: upstream-centos-7
        name-filter: ci.m1.nodepool
        username: jenkins
        min-ram: 8192
        config-drive: true
