---
- name: Login to registry
  command: >-
    {{ container_command }} login {{ item.server }}
    --username  {{ item.serv_secret.user }} --password "$PSSW"
  changed_when: true
  environment:
    PSSW: "{{ item.serv_secret.password }}"
  no_log: true
  loop: "{{ registry_server }}"

- name: Check if login succeded
  command: >-
    {{ container_command }} login {{ item.server }} --get-login
  changed_when: false
  register: login_
  loop: "{{ registry_server }}"

- name: Print if logged in
  debug:
    msg: "Logged in as '{{ item.stdout }}'"
  loop: "{{ login_.results }}"
