---
- name: Ensure you are logged into the OpenShift
  ansible.builtin.include_tasks: openshift_login.yaml

- name: Pause the machineconfig configuration if mcp is not needed
  ansible.builtin.shell: |
    oc patch machineconfigpool {{ item }} --type merge --patch '{"spec": {"paused": true }}'
  loop:
    - master
    - worker
  changed_when: false

- name: Disable Machine Config Operaotr in ClusterVersion
  ansible.builtin.shell: >
    oc patch clusterversion version -p
    '{"spec":{"overrides":[{"group":"machineconfiguration.openshift.io",
    "kind":"Deployment",
    "name":"machine-config-operator",
    "namespace":"openshift-machine-config-operator",
    "unmanaged":true}]}}' --type=merge

- name: Scale down the Machine Config Operator deployment and controller
  ansible.builtin.shell: |
    oc scale deployment -n openshift-machine-config-operator {{ item }} --replicas=0
  loop:
    - machine-config-operator
    - machine-config-controller

- name: Print current machineconfigpool
  ansible.builtin.command: oc get machineconfigpool
  changed_when: false
