---
- name: Find out UUID of instance with metadata URL
  shell: |
    set -euxo pipefail
    (curl -s http://169.254.169.254/openstack/latest/meta_data.json || \
    cat /mnt/config/openstack/latest/meta_data.json) | \
    {{ ansible_python.executable }} -c 'import json, sys; print(json.load(sys.stdin)["uuid"])'
  register: js

- name: Set UUID of undercloud
  set_fact:
    undercloud_uuid: "{{ js.stdout }}"
