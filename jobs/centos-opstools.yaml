- builder:
    name: 'centos-opstools-virtualenv'
    defaults: global
    builders:
      - shell: |
          set -e
          sudo -H pip install -U virtualenv
          virtualenv $ZUUL_PROJECT/venv
          source $ZUUL_PROJECT/venv/bin/activate
          pip install --upgrade pip tox

- builder:
    name: 'centos-opstools-bindeps'
    defaults: global
    builders:
      - shell: |
          set -e
          sudo yum -y install centos-release-openstack-newton
          sudo yum -y install libffi-devel openssl-devel libyaml-devel

- job:
    name: 'centos-opstools-tox'
    defaults: global
    builders:
      - prepare-workspace
      - centos-opstools-bindeps
      - centos-opstools-virtualenv
      - shell: |
          set -e
          source $ZUUL_PROJECT/venv/bin/activate
          pushd $ZUUL_PROJECT
          tox
          popd
    triggers:
      - zuul
    node: bare-centos-7

- job:
    name: 'centos-opstools-doc'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          set +e
          mkdir $WORKSPACE/artifacts

          sudo yum -y install rubygems
          gem install asciidoctor

          pushd $ZUUL_PROJECT
          ~/bin/asciidoctor -v -b html5 *.txt -D $WORKSPACE/artifacts
          popd
    publishers:
      - zuul-swift-upload
    triggers:
      - zuul
    node: bare-centos-7
- job:
    name: 'centos-opstools-rpmlint'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          set -e
          sudo yum -y install rpmlint
          pushd $ZUUL_PROJECT
          rpmlint *.spec
          popd
    triggers:
      - zuul
    node: bare-centos-7
- job:
    name: 'centos-opstools-rpmbuild'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          set -e
          mkdir $WORKSPACE/artifacts
          sudo yum -y install rpm-build rpmdevtools centos-release-opstools
          pushd $ZUUL_PROJECT
          spectool -g  *.spec
          sudo yum-builddep *.spec
          rpmbuild -D '_sourcedir .' -D '_specdir .' -D '_topdir .' -ba *.spec
          # move built rpms to artifacts for later use
          mv SRPMS/* $WORKSPACE/artifacts
          mv RPMS/* $WORKSPACE/artifacts
          popd
    publishers:
      - zuul-swift-upload
    triggers:
      - zuul
    node: bare-centos-7
