- job:
    name: 'no-op'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          echo "This is a no-op job"
          exit 0
    triggers:
      - zuul
    node: master

- job:
    name: 'tox-jjb'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          set +e
          cd $ZUUL_PROJECT
          tox -e jjb
    triggers:
      - zuul
    node: bare-centos-7

- job:
    name: 'publish-cico-jjb'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          set +e
          cd $ZUUL_PROJECT
          # Ensure that there's no failure before pushing
          tox -e jjb

          # Update jobs
          source .tox/jjb/bin/activate
          pushd jenkins
          jenkins-jobs --conf $JJB_CONFIG update jobs
          popd
    triggers:
      - zuul
    node: bare-centos-7
    wrappers:
      - credentials-binding:
        - file:
           credential-id: b578a3ee-cf49-4250-899a-0bc7f84363c2
           variable: JJB_CONFIG
