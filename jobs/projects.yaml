# This file won't be updated and must be updated manually
# Test

- job:
    name: 'pkg-validate'
    defaults: global
    builders:
      - base-pkg-validation:
          buildtarget: "cloud7-openstack-liberty-el7"
      - shell: |
          true
    triggers:
      - zuul
    node: koji-centos-7

- job:
    name: 'pkg-export'
    defaults: global
    builders:
      - base-pkg-validation:
          buildtarget: "cloud7-openstack-liberty-el7"
      - shell: |
          true
    triggers:
      - zuul
    node: koji-centos-7

- job:
    name: 'upstream-update'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          date
          # Manage SSH keyring for git+push on rpmfactory
          chmod 600 $SECRETKEY
          eval $(ssh-agent)
          ssh-add $SECRETKEY
          echo -e "Host *\n  StrictHostKeyChecking no" > ~/.ssh/config
          chmod 600 ~/.ssh/config
          # Prepare sfrdo
          git clone http://softwarefactory-project.io/r/p/python-sfrdo.git --depth 1
          # python-virtualenv installed in the next relase
          # http://softwarefactory-project.io/r/gitweb?p=software-factory.git;a=blob_plain;f=image/packages/rpm_centos.txt;hb=HEAD
          pushd python-sfrdo
            virtualenv ../sfrdo-venv
            . ../sfrdo-venv/bin/activate
            pip install -r requirements.txt
            python setup.py install
          popd
          # Run script
          sfrdo sync_repo --type All
    wrappers:
      - credentials-binding:
        - file:
           credential-id: d3e139ef-cd37-4395-b4f0-2d403acbf727
           variable: SECRETKEY
    triggers:
      - zuul
    node: koji-centos-7

- job:
    name: 'distgit-update'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          date
          # Manage SSH keyring for git+push on rpmfactory
          chmod 600 $SECRETKEY
          eval $(ssh-agent)
          ssh-add $SECRETKEY
          echo -e "Host *\n  StrictHostKeyChecking no" > ~/.ssh/config
          chmod 600 ~/.ssh/config
          # Prepare sfrdo
          git clone http://softwarefactory-project.io/r/p/python-sfrdo.git --depth 1
          # python-virtualenv installed in the next relase
          # http://softwarefactory-project.io/r/gitweb?p=software-factory.git;a=blob_plain;f=image/packages/rpm_centos.txt;hb=HEAD
          pushd python-sfrdo
            virtualenv ../sfrdo-venv
            . ../sfrdo-venv/bin/activate
            pip install -r requirements.txt
            python setup.py install
          popd
          # Run script
          sfrdo sync_repo --type All --distgit
    wrappers:
      - credentials-binding:
        - file:
           credential-id: d3e139ef-cd37-4395-b4f0-2d403acbf727
           variable: SECRETKEY
    triggers:
      - zuul
    node: koji-centos-7


<<<<<<< HEAD
- job:
    name: 'puppet-syntax'
    defaults: global
    builders:
      - prepare-workspace
      - puppet-prepare-node
      - puppet-install
      - shell: |
          cd $ZUUL_PROJECT
          find . -iname *.pp | xargs puppet parser validate --modulepath=`pwd`/modules
          for f in `find . -iname *.erb` ; do
            erb -x -T '-' $f | ruby -c
          done
    triggers:
      - zuul
    node: bare-centos-7
=======
>>>>>>> ff7d8b9... Split jobs and fix pkg-validate and pkg-export

