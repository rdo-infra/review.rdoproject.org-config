- job:
    name: 'upstream-update'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          # Manage SSH keyring for git+push on rpmfactory
          chmod 600 $SECRETKEY
          eval $(ssh-agent)
          ssh-add $SECRETKEY
          echo -e "Host *\n  StrictHostKeyChecking no" > ~/.ssh/config
          chmod 600 ~/.ssh/config
          git clone https://review.rdoproject.org/r/rdo_gating_scripts --depth 1
          cd rdo_gating_scripts/rdo-upstream-sync
          sudo pip install -r requirements.txt
          python upstream-sync.py
    wrappers:
      - credentials-binding:
        - file:
           credential-id: b9dbf561-24d3-4cdd-bee8-e2e423762537
           variable: SECRETKEY
    triggers:
      - zuul
    node: rdo-centos7-liberty
