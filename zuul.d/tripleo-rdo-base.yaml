---
# This file contains parent layouts for all TripleO RDO Cloud related jobs.
# Do not add children specific layout here.

- job:
    name: tripleo-ci-base-ovb-rdo
    abstract: true
    description: |
        Base abstract job for OVB in RDO CI zuulv3 jobs
    parent: tripleo-ci-base-ovb-notebroker
    timeout: 10800
    nodeset: tripleo-ovb-centos-7-primary

- job:
    name: tripleo-ci-base-ovb-tebroker
    abstract: true
    description: |
        Base abstract job for OVB in RDO CI zuulv3 jobs with te-broker
    parent: tripleo-ci-base-ovb
    timeout: 10800
    nodeset: tripleo-ovb-centos-7-primary
    pre-run:
      - playbooks/tripleo-rdo-base/pre.yaml

- job:
    name: tripleo-ci-base-ovb-notebroker
    abstract: true
    description: |
        Base abstract job for OVB in RDO CI zuulv3 jobs without te-broker
    parent: tripleo-ci-base-ovb
    timeout: 10800
    nodeset: tripleo-ovb-centos-7-primary
    pre-run:
      - playbooks/tripleo-rdo-base/pre.yaml
      - playbooks/tripleo-rdo-base/pre-ovb-create.yaml
    post-run: playbooks/tripleo-rdo-base/post-ovb-delete.yaml
    secrets:
      - cloud_secrets

- job:
    name: tripleo-ci-base-multinode-rdo
    abstract: true
    description: |
        Base abstract job for multinode in RDO CI zuulv3 jobs
    parent: tripleo-ci-base-multinode
    nodeset: two-centos-7-nodes
    pre-run:
      - playbooks/tripleo-rdo-base/pre.yaml

- job:
    name: tripleo-ci-base-singlenode-rdo
    abstract: true
    description: |
        Base abstract job for singlenode in RDO CI zuulv3 jobs
    parent: tripleo-ci-base-singlenode
    nodeset: single-centos-7-node
    pre-run:
      - playbooks/tripleo-rdo-base/pre.yaml

- job:
    name: tripleo-ci-base-singlenode-rdo-containers-build-push
    abstract: true
    description: |
        Base abstract container build job for singlenode in RDO CI zuulv3 jobs
    parent: tripleo-build-containers-base
    nodeset: single-centos-7-node
    pre-run:
      - playbooks/tripleo-rdo-base/pre.yaml

- job:
    name: tripleo-ci-base-standalone-rdo
    abstract: true
    description: |
        Base abstract job for standalone in RDO CI zuulv3 jobs
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    pre-run:
      - playbooks/tripleo-rdo-base/pre.yaml


- job:
    name: tripleo-ci-base-ovb-periodic
    parent: tripleo-ci-base-ovb-rdo
    pre-run: playbooks/tripleo-ci-periodic-base/pre.yaml
    post-run: playbooks/tripleo-ci-periodic-base/post.yaml
    required-projects:
      - config
    secrets:
      - dlrnapi

- job:
    name: tripleo-ci-base-ovb-periodic-upload
    parent: tripleo-ci-base-ovb-periodic
    post-run: playbooks/tripleo-ci-periodic-base-upload/post.yaml
    secrets:
      - uploader_ssh_key

- job:
    name: tripleo-ci-base-multinode-periodic
    parent: tripleo-ci-base-multinode-rdo
    pre-run: playbooks/tripleo-ci-periodic-base/pre.yaml
    post-run: playbooks/tripleo-ci-periodic-base/post.yaml
    required-projects:
      - config
    secrets:
      - dlrnapi

- job:
    name: tripleo-ci-base-singlenode-periodic
    parent: tripleo-ci-base-singlenode-rdo
    pre-run: playbooks/tripleo-ci-periodic-base/pre.yaml
    post-run: playbooks/tripleo-ci-periodic-base/post.yaml
    required-projects:
      - config
    secrets:
      - dlrnapi
- job:
    name: tripleo-ci-base-standalone-periodic
    parent: tripleo-ci-base-standalone-rdo
    pre-run: playbooks/tripleo-ci-periodic-base/pre.yaml
    post-run: playbooks/tripleo-ci-periodic-base/post.yaml
    required-projects:
      - config
    secrets:
      - dlrnapi

- job:
    name: periodic-tripleo-ci-base-scenario001-standalone-master
    parent: tripleo-ci-base-standalone-periodic
    vars:
      featureset: '052'
      release: master
      standalone_ceph: true
      featureset_override:
        standalone_container_cli: docker
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario001-standalone.yaml'
        tempest_plugins:
          - python-telemetry-tests-tempest
          - python-heat-tests-tempest
        test_white_regex: ''
        tempest_workers: 1
        tempest_extra_config: {'telemetry.alarm_granularity': '60'}
        tempest_whitelist:
          - 'tempest.api.identity.v3'
          - 'tempest.scenario.test_volume_boot_pattern.TestVolumeBootPattern.test_volume_boot_pattern'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'

- job:
    name: periodic-tripleo-ci-base-scenario002-standalone-master
    parent: tripleo-ci-base-standalone-periodic
    vars:
      featureset: '052'
      release: master
      featureset_override:
        standalone_container_cli: docker
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario002-standalone.yaml'
        tempest_whitelist:
          - 'tempest.api.object_storage.test_object_services.ObjectTest'
          - 'barbican_tempest_plugin.tests.scenario.test_volume_encryption.VolumeEncryptionTest'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'
        tempest_plugins:
          - python-telemetry-tests-tempest
          - python-barbican-tests-tempest
        tempest_extra_config:
          auth.tempest_roles: "'Member, creator'"
          telemetry.alarm_granularity: '60'
        test_white_regex: ""

- job:
    name: periodic-tripleo-ci-base-scenario003-standalone-master
    parent: tripleo-ci-base-standalone-periodic
    vars:
      featureset: '052'
      release: master
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario003-standalone.yaml'
        standalone_container_cli: docker
        tempest_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'sahara_tempest_plugin.tests.api.test_data_sources.DataSourceTest'
          - 'mistral_tempest_tests.tests.api.v2.test_actions.ActionTestsV2'
        tempest_plugins:
          - python-sahara-tests-tempest
          - python-mistral-tests-tempest
        test_white_regex: ""

- job:
    name: periodic-tripleo-ci-base-scenario004-standalone-master
    parent: tripleo-ci-base-standalone-periodic
    vars:
      featureset: '052'
      release: master
      standalone_ceph: true
      featureset_override:
        standalone_container_cli: docker
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario004-standalone.yaml'
        tempest_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'manila_tempest_tests.tests.api.test_shares.SharesCephFSTest.test_create_get_delete_share'
        tempest_plugins:
          - python2-manila-tests-tempest
        tempest_extra_config:
          'share.multitenancy_enabled': 'False'
          'share.enable_protocols': 'cephfs'
          'share.capability_snapshot_support': 'False'
          'share.capability_create_share_from_snapshot_support': 'False'
        test_white_regex: ''

- job:
    name: tripleo-ci-base-singlenode-containers-build
    abstract: true
    parent: tripleo-ci-base-singlenode-rdo
    post-run: playbooks/tripleo-ci-periodic-base/containers-build.yaml
    post-timeout: 10800
    required-projects:
      - config
    secrets:
      - rdo_registry
    vars:
       featureset: '023'

- job:
    name: tripleo-ci-base-promote-consistent-to-tripleo-ci-testing
    abstract: true
    timeout: 1800
    run: playbooks/tripleo-ci-base-promote-consistent-to-tripleo-ci-testing/run.yaml
    post-run: playbooks/tripleo-ci-base-promote-consistent-to-tripleo-ci-testing/post.yaml
    required-projects:
      - config
    secrets:
      - dlrnapi

- job:
    name: tripleo-ci-reproducer-base
    abstract: true
    pre-run: playbooks/tripleo-ci-reproducer-base/pre.yaml
    post-run: playbooks/tripleo-ci-reproducer-base/post.yaml
    vars:
      tripleo_gerrit_key_name: id_rsa_tripleo_gerrit
      tripleo_gerrit_key_path: "~/.ssh/{{ tripleo_gerrit_key_name }}"
    secrets:
      - tripleo_gerrit_ssh_key
