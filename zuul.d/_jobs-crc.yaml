---
- job:
    name: base-crc
    parent: base-minimal
    description: |
      A base job that starts CRC environment
    pre-run:
      # Playbook to add tripleo-ci team ssh keys to the node
      - playbooks/tripleo-rdo-base/pre.yaml
        # Playbooks for podman
      - playbooks/crc/podman.yaml
      - playbooks/crc/start.yaml
    required-projects:
      - name: github.com/openstack-k8s-operators/install_yamls
        override-checkout: main
      - opendev.org/zuul/zuul-jobs
      - config
    attempts: 3
    secrets:
      - name: crc_secret
        secret: crc_secret
      - name: quay_login_secret_name
        secret: quay_nextgen_zuulgithubci

- job:
    name: base-simple-crc
    parent: base-minimal
    description: |
      A base job that starts CRC environment
    pre-run:
      # Playbook to add tripleo-ci team ssh keys to the node
      - playbooks/tripleo-rdo-base/pre.yaml
        # Playbooks for podman
      - playbooks/crc/podman.yaml
      - playbooks/crc/simple-start.yaml
    post-run:
      - playbooks/ci-framework-rdo-base/dlrn/dlrn-report.yaml
    required-projects:
      - config
      - opendev.org/zuul/zuul-jobs
      - name: github.com/openstack-k8s-operators/ci-framework
        override-checkout: main
    roles:
      - zuul: github.com/openstack-k8s-operators/ci-framework
    attempts: 1
    vars:
      cifmw_dlrn_report_result: false
    secrets:
      - name: crc_secret
        secret: crc_secret
      - name: quay_login_secret_name
        secret: quay_nextgen_zuulgithubci
      - dlrnapi

- job:
    name: base-extracted-crc
    parent: base-minimal
    abstract: true
    description: |
      A base job that starts CRC environment from the extracted CRC image
    pre-run:
      # Playbook to add tripleo-ci team ssh keys to the node
      - playbooks/tripleo-rdo-base/pre.yaml
      # Playbook that creates the environment network in the target cloud
      - playbooks/crc/bootstrap-ci-network.yml
      # Playbooks for podman
      - playbooks/crc/podman.yaml
    post-run:
      # Deletes generated network resources
      - playbooks/crc/bootstraped-ci-network-cleanup.yml
      - playbooks/ci-framework-rdo-base/dlrn/dlrn-report.yaml
    required-projects:
      - opendev.org/zuul/zuul-jobs
      - config
      - name: github.com/openstack-k8s-operators/ci-framework
        override-checkout: main
    roles:
      - zuul: github.com/openstack-k8s-operators/ci-framework
    attempts: 3
    vars:
      cifmw_dlrn_report_result: false
    secrets:
      - name: quay_login_secret_name
        secret: quay_nextgen_zuulgithubci
      - name: cloud_secrets
        secret: cloud_secrets
      - dlrnapi


- job:
    name: cifmw-podified-multinode-edpm-base-crc-test-base
    parent: base-extracted-crc
    timeout: 10800
    attempts: 1
    files:
      - playbooks/
    nodeset:
      nodes:
        - name: controller
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: compute
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: crc
          label: coreos-crc-extracted-xxl
    vars:
      zuul_log_collection: true
      crc_ci_bootstrap_cloud_name: vexxhost
      crc_ci_bootstrap_networking:
        networks:
          default:
            mtu: 1500
            range: 192.168.122.0/24
          internal-api:
            vlan: 20
            range: 172.17.0.0/24
          storage:
            vlan: 21
            range: 172.18.0.0/24
          tenant:
            vlan: 22
            range: 172.19.0.0/24
        instances:
          controller:
            networks:
              default:
                ip: 192.168.122.11
          crc:
            networks:
              default:
                ip: 192.168.122.10
              internal-api:
                ip: 172.17.0.5
              storage:
                ip: 172.18.0.5
              tenant:
                ip: 172.19.0.5
          compute:
            networks:
              default:
                ip: 192.168.122.100
              internal-api:
                ip: 172.17.0.100
                config_nm: false
              storage:
                ip: 172.18.0.100
                config_nm: false
              tenant:
                ip: 172.19.0.100
                config_nm: false
