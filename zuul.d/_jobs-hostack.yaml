---
- job:
    name: base-hotstack
    parent: base-minimal
    abstract: true
    description: |
      A base job that starts hotstack environment
    pre-run:
      - playbooks/hotstack/pre.yaml
    run:
      - playbooks/hotstack/run.yaml
    post-run:
      - playbooks/hotstack/post.yaml
    required-projects:
      - name: github.com/openstack-k8s-operators/hotstack
      - opendev.org/zuul/zuul-jobs
      - config
    attempts: 1
    secrets:
      - name: crc_secret_pabrodri
        secret: crc_secret_pabrodri
      - name: cloud_secrets
        secret: cloud_secrets
    vars:
      cloud_name: "{{ nodepool.cloud | replace('-nodepool-tripleo', '') }}"
      scenario_dir: >-
        {{
          [
            zuul.executor.work_root,
            zuul.projects['github.com/openstack-k8s-operators/hotstack'].src_dir,
            'scenarios'
          ] | ansible.builtin.path_join
        }}
      cloud_stack_params:
        # TODO(hjensas):
        # - Need images in the cloud
        # - Values need to be adjusted
        vexxhost:
          dns_servers:
            - 199.204.44.24
            - 199.204.47.54
          ntp_servers: []
          router_external_network: public
          floating_ip_network: public
          controller_params:
            image: hotstack-controller
            flavor: ci.m1.small
          ocp_master_params:
            image: ipxe-boot-usb
            flavor: 24vcpu_48GB
          ocp_worker_params:
            image: ipxe-boot-usb
            flavor: 24vcpu_48GB
          compute_params:
            image: CentOS-Stream-GenericCloud-9
            flavor: ci.m1.xlarge
          networker_params:
            image: CentOS-Stream-GenericCloud-9
            flavor: ci.m1.medium
          bmh_params:
            image: sushy-tools-blank-image
            cd_image: sushy-tools-blank-image
            flavor: ci.m1.xlarge
          ironic_params:
            image: sushy-tools-blank-image
            cd_image: sushy-tools-blank-image
            flavor: ci.m1.medium
      # These are here for compatibility
      dns_servers: "{{ cloud_stack_params[cloud_name].dns_servers }}"
      ntp_servers: "{{ cloud_stack_params[cloud_name].ntp_servers }}"

- job:
    name: base-hotstack-controller-image-periodic
    parent: base-minimal
    abstract: true
    description: |
      A peridoc job to update the hotstack-controller image
    pre-run:
      - playbooks/hotstack/pre.yaml
    run:
      - playbooks/hotstack/hotstack-controller-image-run.yaml
    post-run:
      - playbooks/hotstack/hotstack-image-post.yaml
    required-projects:
      - name: github.com/openstack-k8s-operators/hotstack
      - opendev.org/zuul/zuul-jobs
      - config
    attempts: 1
    secrets:
      - name: cloud_secrets
        secret: cloud_secrets

- job:
    name: base-hotstack-blank-image-periodic
    parent: base-minimal
    abstract: true
    description: |
      A peridoc job to update the hotstack-blank image
    pre-run:
      - playbooks/hotstack/pre.yaml
    run:
      - playbooks/hotstack/hotstack-blank-image-run.yaml
    post-run:
      - playbooks/hotstack/hotstack-image-post.yaml
    required-projects:
      - name: github.com/openstack-k8s-operators/hotstack
      - opendev.org/zuul/zuul-jobs
      - config
    attempts: 1
    secrets:
      - name: cloud_secrets
        secret: cloud_secrets

- job:
    name: base-hotstack-ixpe-image-periodic
    parent: base-minimal
    abstract: true
    description: |
      A peridoc job to update the hotstack-blank image
    pre-run:
      - playbooks/hotstack/pre.yaml
    run:
      - playbooks/hotstack/hotstack-ipxe-image-run.yaml
    post-run:
      - playbooks/hotstack/hotstack-image-post.yaml
    required-projects:
      - name: github.com/openstack-k8s-operators/hotstack
      - opendev.org/zuul/zuul-jobs
      - config
    attempts: 1
    secrets:
      - name: cloud_secrets
        secret: cloud_secrets

# TBD
# - job:
#    name: vexxhost-hotstack-controller-image-periodic
#    parent: base-hotstack-controller-image-periodic
#    vars:
#      cloud_name: vexxhost
# - job:
#    name: vexxhost-hotstack-blank-image-periodic
#    parent: base-hotstack-controller-image-periodic
#    vars:
#      cloud_name: vexxhost
# - job:
#    name: vexxhost-hotstack-ipxe-image-periodic
#    parent: base-hotstack-controller-image-periodic
#    vars:
#      cloud_name: vexxhost
