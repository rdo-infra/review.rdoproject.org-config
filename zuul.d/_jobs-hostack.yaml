---
- job:
    name: base-hotstack
    parent: base-minimal
    abstract: true
    description: |
      A base job that starts hotstack environment
    pre-run:
      - playbooks/hotstack/pre.yaml
    run:
      - playbooks/hotstack/run.yaml
    post-run:
      - playbooks/hotstack/post.yaml
    required-projects:
      - name: github.com/openstack-k8s-operators/hotstack
      - opendev.org/zuul/zuul-jobs
      - config
    attempts: 1
    secrets:
      - name: crc_secret_pabrodri
        secret: crc_secret_pabrodri
      - name: cloud_secrets
        secret: cloud_secrets
    vars:
      cloud_name: "{{ nodepool.cloud | replace('-nodepool-tripleo', '') }}"
      scenario_dir: >-
        {{
          [
            zuul.executor.work_root,
            zuul.projects['github.com/openstack-k8s-operators/hotstack'].src_dir,
            'scenarios'
          ] | ansible.builtin.path_join
        }}
      cloud_stack_params:
        vexxhost:
          dns_servers:
            - 199.204.44.24
            - 199.204.47.54
          ntp_servers: []
          router_external_network: public
          floating_ip_network: public
          controller_params:
            image: hotstack-controller
            # We could use 1 VCPU + 2GB RAM
            flavor: 8vcpu_24GB
          ocp_master_params:
            image: ipxe-boot-usb
            flavor: 16vcpu_48GB
          ocp_worker_params:
            image: ipxe-boot-usb
            flavor: 16vcpu_48GB
          compute_params:
            image: cloud-centos-9-stream
            # We could use 2 vcpu 4GB RAM
            flavor: 8vcpu_24GB
          networker_params:
            image: cloud-centos-9-stream
            # We could use 2 vcpu 4GB RAM
            flavor: 8vcpu_24GB
          bmh_params:
            image: sushy-tools-blank-image
            cd_image: sushy-tools-blank-image
            # We could use 2 vcpu 4GB RAM
            flavor: 8vcpu_24GB
          ironic_params:
            image: sushy-tools-blank-image
            cd_image: sushy-tools-blank-image
            # We could use 1 vcpu 2GB RAM
            flavor: 8vcpu_24GB
      # These are here for compatibility
      dns_servers: "{{ cloud_stack_params[cloud_name].dns_servers }}"
      ntp_servers: "{{ cloud_stack_params[cloud_name].ntp_servers }}"
