---
- job:
    name: config-check
    description: Validate the config repo.
    run: playbooks/config/check.yaml
    secrets:
      - sf_service_user
    nodeset:
      nodes: []
    allowed-projects:
      - config

- semaphore:
    name: semaphore-config-update
    max: 1

- job:
    name: config-update
    description: Deploy config repo updates
    run: playbooks/config/update.yaml
    semaphore: semaphore-config-update
    secrets:
      - site_install_server
    nodeset:
      nodes: []
    allowed-projects:
      - config

- project:
    name: config
    check:
      jobs:
        - config-check
    gate:
      jobs:
        - config-check
# TODO: enable config-update only after zuulv2 job is disabled
#    post:
#      jobs:
#        - config-update
