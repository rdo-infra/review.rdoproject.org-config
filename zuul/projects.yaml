jobs:
  # ref_uuid = params['ZUUL_REF'].split('/')[-1]
  # params['LOG_PATH'] = "{base}/{pipeline}/{job}/{ref}".format(
  #   base=params['BASE_LOG_PATH'],
  #   pipeline=params['ZUUL_PIPELINE'],
  #   job=job.name,
  #   ref=ref_uuid
  #)
  - name: ^test-logs$
    failure-pattern: https://logs.rdoproject.org/{build.parameters[LOG_PATH]}
    success-pattern: https://logs.rdoproject.org/{build.parameters[LOG_PATH]}

  - name: ^DLRN-rpmbuild$
    branch: ^(master|stable/pike)|(rpm-)|(^(?!common)(\w+)-rdo)$

  - name: ^DLRN-rpmbuild-fedora$
    branch: ^(master)|(rpm-master)$
    voting: false

  - name: ^DLRN-build-tripleo$
    branch: ^(master|stable/pike)|(rpm-)|(^(?!common)(\w+)-rdo)$
    voting: false

  - name: ^rdo-kolla-build-integration$
    branch: ^(master|stable/pike)$

  - name: ^queens-distgit-cbs-(validate|final-build)$
    branch: ^queens-rdo$

  - name: ^pike-distgit-cbs-(validate|final-build)$
    branch: ^pike-rdo$

  - name: ^ocata-distgit-cbs-(validate|final-build)$
    branch: ^ocata-rdo$

  - name: ^newton-distgit-cbs-validate$
    branch: ^newton-rdo$

  - name: ^common-distgit-cbs-(validate|final-build)$
    branch: ^common-rdo$

  - name: ^gate-rpmlint$
    branch: ^rpm-master$

  # -nv jobs are never voting.
  - name: ^.*-nv$
    voting: false

project-templates:
  - name: noop
    check:
      - noop
    gate:
      - noop

  - name: package-check-jobs
    check:
      - tox-validate
    gate:
      - tox-validate

  - name: package-distgit-check-jobs
    check:
      - DLRN-rpmbuild:
          - gate-rpmlint
          - DLRN-build-tripleo
      - DLRN-rpmbuild-fedora
      - newton-distgit-cbs-validate
      - ocata-distgit-cbs-validate
      - pike-distgit-cbs-validate
      - queens-distgit-cbs-validate
      - common-distgit-cbs-validate
    gate:
      - DLRN-rpmbuild
      - ocata-distgit-cbs-final-build
      - pike-distgit-cbs-final-build
      - queens-distgit-cbs-final-build
      - common-distgit-cbs-final-build

projects:
  - name: rdo-infra/ci-config
    check:
      - tox-jjb
    gate:
      - tox-jjb
    post:
      - publish-cico-jjb
