pipelines:
  - name: openstack-check
    description: Newly uploaded patchsets enter this pipeline to receive an initial +/-1 Verified vote from Jenkins.
    manager: IndependentPipelineManager
    source: openstack
    precedence: normal
    require:
      open: True
      current-patchset: True
    trigger:
      openstack:
        - event: patchset-created
        - event: change-restored
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*(recheck|reverify|check-rdo|verify-rdo)
    success:
      openstack:
        verified: 1
    failure:
      openstack:
        verified: -1
      smtp:
        from: jenkins@review.rdoproject.org
        to: rdo-infra-list@redhat.com
        subject: '[Zuul] Job failed in openstack-check pipeline: {change.project}'

  - name: openstack-check-verified
    description: Patchsets that have been verified from upstream OpenStack (check pipeline).
    manager: IndependentPipelineManager
    source: openstack
    precedence: normal
    require:
      open: True
      current-patchset: True
    trigger:
      openstack:
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*(recheck|reverify|check-rdo|verify-rdo)
        - event: comment-added
          approval:
            - verified: 1
          username: ^(jenkins|zuul)$
    failure:
      smtp:
        from: jenkins@review.rdoproject.org
        to: rdo-infra-list@redhat.com
        subject: '[Zuul] Job failed in openstack-check-verified pipeline: {change.project}'

  - name: openstack-post
    description: This pipeline runs jobs that operate after each change is merged in upstream OpenStack.
    manager: IndependentPipelineManager
    precedence: low
    trigger:
      openstack:
        - event: ref-updated
          ref: ^(?!refs/).*$
    failure:
      smtp:
        from: jenkins@review.rdoproject.org
        to: rdo-infra-list@redhat.com
        subject: '[Zuul] Job failed in openstack-post pipeline: {change.project}'

projects:
  - name: openstack/python-openstackclient
    openstack-check-verified:
      - DLRN-rpmbuild

  - name: openstack/python-tripleoclient
    openstack-check-verified:
      - DLRN-rpmbuild

  - name: openstack/rpm-packaging
    openstack-check:
      - DLRN-rpmbuild-rpm-packaging

  - name: openstack/releases
    openstack-post:
      - rdo-send-stable-release
