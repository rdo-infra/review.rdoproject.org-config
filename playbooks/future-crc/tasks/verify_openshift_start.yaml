---
- name: Login to the OpenShift
  ansible.builtin.command: >
    oc login
    -u kubeadmin
    -p "{{ crc_password | default('123456789')}}"
    https://api.crc.testing:6443
    --insecure-skip-tls-verify=true
  register: _openshift_login
  until: _openshift_login.rc != 1
  retries: 60
  delay: 10

- name: Copy script ensure_services_up.sh
  ansible.builtin.copy:
    src: ensure_services_up.sh
    dest: /tmp/ensure_services_up.sh
    mode: '0755'

- name: Ensure all pods are up and running
  ansible.builtin.command: /tmp/ensure_services_up.sh
