---
- hosts: all
  name: Setup for building overcloud images
  vars:
    workspace: "{{ ansible_user_dir }}/workspace"
  tasks:
    # Set facts used by upstream tripleo-ci build-images role. The build-images
    # jinja template reads these + exports DIB variables before building
    - name: Set dib_local_image and other facts used by tripleo-ci build-image role build template
      set_fact:
        dib_local_image: "{{ rhel_image_source | urlsplit('path') | basename }}"
        dib_node_dist: "rhel"
        dib_release: "8"
        dib_yum_repo_conf: " /etc/yum.repos.d/delorean.repo /etc/yum.repos.d/osp15-deps.repo /etc/yum.repos.d/rh-cloud.repo "
        cacheable: true

    - name: Download rhel source image
      get_url:
        url: "{{ rhel_image_source }}"
        dest: "{{ workspace }}/{{ dib_local_image }}"

