- hosts: primary
  vars:
    registry_url: "{{ lookup('env', 'REGISTRY_URL') | default('quay.rdoproject.org', true) }}"
    registry_username: "{{ quay_login_secret_name.username }}"
    registry_password: "{{ quay_login_secret_name.passwd }}"
  tasks:
    - name: Container Logging to RDO registry for CentOS 7 and Fedora 28
      when:
        - ansible_distribution|lower != 'redhat'
        - push_containers|default(true)|bool
      block:
        - name: Install python docker
          become: true
          package:
            name: python-docker

        - name: Login to RDO registry
          become: "{{ item }}"
          docker_login:
            registry_url: "{{ registry_url }}"
            username: "{{ registry_username }}"
            password: "{{ registry_password }}"
            reauthorize: true
          with_items:
            - true
            - false
