- hosts: all
  tasks:
    - name: Install koji from EPEL
      shell:
        cmd: |
          sudo dnf install -y epel-release;
          sudo dnf config-manager --enable epel;
          sudo dnf install -y koji;
          sudo dnf config-manager --disable epel;
      changed_when: true

    - name: Install deps
      shell:
        cmd: |
          sudo dnf install -y jq rpmdevtools;
      changed_when: true

    - name: Create SSH directory
      file:
        dest: ~/.ssh
        mode: 0700
        state: directory

    - name: Create rdoinfo SSH private key
      copy:
        content: "{{ rdoinfo_ssh.private_key }}"
        dest: ~/.ssh/rdoinfo_id_rsa
        mode: 0600

    - name: Copy functions.sh
      copy:
        src: files/functions.sh
        dest: '{{ ansible_user_dir }}/functions.sh'
        owner: '{{ ansible_user }}'
        group: '{{ ansible_user }}'
        mode: 0644
